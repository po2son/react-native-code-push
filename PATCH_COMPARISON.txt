# CodePush íŒ¨ì¹˜ ì—…ë°ì´íŠ¸ ì‹œê°í™” ê°€ì´ë“œ

## ğŸ“Œ í•µì‹¬ ë¹„êµ: ì‹±ê¸€ íŒ¨ì¹˜ vs ë©€í‹° íŒ¨ì¹˜

---

## 1ï¸âƒ£ ì‹±ê¸€ íŒ¨ì¹˜ í”Œë¡œìš° (ê¸°ì¡´ ë°©ì‹)

```mermaid
flowchart TD
    A[ì•± ì‹œì‘: v1.0.10] --> B[ì„œë²„ ì—…ë°ì´íŠ¸ ì²´í¬]
    B --> C{patches ë°°ì—´ ìˆë‚˜?}
    C -->|ì—†ìŒ| D[download_url ì‚¬ìš©]
    
    D --> E[ë‹¨ì¼ íŒ¨ì¹˜ ë‹¤ìš´ë¡œë“œ]
    E --> F[ì••ì¶• í•´ì œ]
    F --> G{Full or Diff?}
    
    G -->|Diff| H[í˜„ì¬ íŒ¨í‚¤ì§€ ë³µì‚¬]
    H --> I[deletedFiles ì‚­ì œ]
    I --> J[ìƒˆ íŒŒì¼ ë³‘í•©]
    
    G -->|Full| J
    
    J --> K[í•´ì‹œ ê²€ì¦]
    K --> L[ì„œëª… ê²€ì¦]
    L --> M[ë©”íƒ€ë°ì´í„° ì €ì¥]
    M --> N[ì•± ì¬ì‹œì‘]
    N --> O[ì—…ë°ì´íŠ¸ ì™„ë£Œ!]
    
    style A fill:#e1f5ff
    style O fill:#c8e6c9
    style D fill:#fff9c4
    style N fill:#ffccbc
```

### ğŸ” ì‹±ê¸€ íŒ¨ì¹˜ íŠ¹ì§•
- âœ… **ê°„ë‹¨í•œ ë¡œì§**: í•œ ë²ˆì— í•˜ë‚˜ì˜ íŒ¨ì¹˜ë§Œ ì²˜ë¦¬
- âœ… **ì•ˆì •ì **: ê²€ì¦ëœ ë°©ì‹
- âŒ **ì¬ì‹œì‘ ë§ìŒ**: v1.0.10 â†’ v1.0.11 â†’ v1.0.12 â†’ ... (ê°ê° ì¬ì‹œì‘)
- âŒ **ì‚¬ìš©ì ê²½í—˜ ë‚˜ì¨**: 5ë²ˆ ì—…ë°ì´íŠ¸ë©´ 5ë²ˆ ì¬ì‹œì‘

---

## 2ï¸âƒ£ ë©€í‹° íŒ¨ì¹˜ í”Œë¡œìš° (ì‹ ê·œ êµ¬í˜„)

```mermaid
flowchart TD
    A[ì•± ì‹œì‘: v1.0.10] --> B[ì„œë²„ ì—…ë°ì´íŠ¸ ì²´í¬]
    B --> C{patches ë°°ì—´ ìˆë‚˜?}
    C -->|ìˆìŒ!| D[downloadAndApplyMultiplePatches í˜¸ì¶œ]
    
    D --> E[ì„ì‹œ ì‘ì—… í´ë” ìƒì„±<br/>temp_multi_patch/]
    E --> F[í˜„ì¬ íŒ¨í‚¤ì§€ ë³µì‚¬<br/>â†’ workingFolder]
    F --> G[ì „ì²´ íŒ¨ì¹˜ í¬ê¸° ê³„ì‚°]
    
    G --> H[íŒ¨ì¹˜ ìˆœì°¨ ì²˜ë¦¬ ì‹œì‘]
    
    H --> I1[Patch 1 ë‹¤ìš´ë¡œë“œ<br/>v1.0.10 â†’ v1.0.11]
    I1 --> I2[ì••ì¶• í•´ì œ]
    I2 --> I3[tempResult ìƒì„±]
    I3 --> I4[diff ì ìš©]
    I4 --> I5[ìƒˆ íŒŒì¼ ë³‘í•©]
    I5 --> I6[workingFolder êµì²´]
    
    I6 --> J1[Patch 2 ë‹¤ìš´ë¡œë“œ<br/>v1.0.11 â†’ v1.0.12]
    J1 --> J2[ì••ì¶• í•´ì œ]
    J2 --> J3[tempResult ìƒì„±]
    J3 --> J4[diff ì ìš©]
    J4 --> J5[ìƒˆ íŒŒì¼ ë³‘í•©]
    J5 --> J6[workingFolder êµì²´]
    
    J6 --> K1[Patch 3, 4, 5...<br/>ê³„ì† ë°˜ë³µ]
    
    K1 --> L[ìµœì¢… workingFolder<br/>â†’ finalUpdateFolder]
    L --> M[í•´ì‹œ ê²€ì¦]
    M --> N[ì„œëª… ê²€ì¦]
    N --> O[ë©”íƒ€ë°ì´í„° ì €ì¥]
    O --> P[ì„ì‹œ í´ë” ì •ë¦¬]
    P --> Q[ì•± ì¬ì‹œì‘ 1íšŒ!]
    Q --> R[v1.0.15 ì™„ë£Œ! ğŸ‰]
    
    style A fill:#e1f5ff
    style R fill:#c8e6c9
    style D fill:#fff59d
    style H fill:#ffccbc
    style Q fill:#ffccbc
```

### ğŸ” ë©€í‹° íŒ¨ì¹˜ íŠ¹ì§•
- âœ… **ì¬ì‹œì‘ 1íšŒ**: ëª¨ë“  íŒ¨ì¹˜ë¥¼ ë‹¤ìš´ë¡œë“œ â†’ ë³‘í•© â†’ í•œ ë²ˆë§Œ ì¬ì‹œì‘
- âœ… **ì‚¬ìš©ì ê²½í—˜ ì¢‹ìŒ**: 30ì´ˆ ëŒ€ê¸° í›„ ë°”ë¡œ ìµœì‹  ë²„ì „
- âœ… **íš¨ìœ¨ì **: ì¤‘ê°„ ë²„ì „ ì‹¤í–‰ ì•ˆ í•¨
- âš ï¸ **ë©”ëª¨ë¦¬ ì‚¬ìš©**: ì‘ì—… ê³µê°„ í•„ìš”
- âš ï¸ **ë³µì¡í•œ ë¡œì§**: ì—ëŸ¬ ì²˜ë¦¬ ì¤‘ìš”

---

## 3ï¸âƒ£ í•µì‹¬ ì°¨ì´ì : ì¬ì‹œì‘ íšŸìˆ˜ ë¹„êµ

```mermaid
gantt
    title ê¸°ì¡´ vs ì‹ ê·œ ì—…ë°ì´íŠ¸ ì‹œê°„ ë¹„êµ (v1.0.10 â†’ v1.0.15)
    dateFormat mm:ss
    axisFormat %M:%S
    
    section ê¸°ì¡´ ë°©ì‹
    v1.0.10â†’v1.0.11 ë‹¤ìš´ :done, a1, 00:00, 5s
    ì¬ì‹œì‘ 1 :crit, a2, after a1, 20s
    v1.0.11â†’v1.0.12 ë‹¤ìš´ :done, a3, after a2, 5s
    ì¬ì‹œì‘ 2 :crit, a4, after a3, 20s
    v1.0.12â†’v1.0.13 ë‹¤ìš´ :done, a5, after a4, 5s
    ì¬ì‹œì‘ 3 :crit, a6, after a5, 20s
    v1.0.13â†’v1.0.14 ë‹¤ìš´ :done, a7, after a6, 5s
    ì¬ì‹œì‘ 4 :crit, a8, after a7, 20s
    v1.0.14â†’v1.0.15 ë‹¤ìš´ :done, a9, after a8, 5s
    ì¬ì‹œì‘ 5 :crit, a10, after a9, 20s
    
    section ì‹ ê·œ ë°©ì‹
    ëª¨ë“  íŒ¨ì¹˜ ë‹¤ìš´+ë³‘í•© :done, b1, 00:00, 30s
    ì¬ì‹œì‘ 1íšŒ :crit, b2, after b1, 20s
```

### ğŸ“Š ì‹œê°„ ë¹„êµ
| ë°©ì‹ | ë‹¤ìš´ë¡œë“œ ì‹œê°„ | ì¬ì‹œì‘ íšŸìˆ˜ | ì´ ì†Œìš” ì‹œê°„ | ì‚¬ìš©ì ëŒ€ê¸° |
|------|--------------|-------------|--------------|-------------|
| ê¸°ì¡´ | 5ì´ˆ Ã— 5íšŒ = 25ì´ˆ | **5íšŒ** | **ì•½ 125ì´ˆ** | ğŸ˜¡ ë§¤ìš° ë‚˜ì¨ |
| ì‹ ê·œ | 25ì´ˆ (í•œë²ˆì—) | **1íšŒ** | **ì•½ 50ì´ˆ** | ğŸ˜Š ì¢‹ìŒ |

---

## 4ï¸âƒ£ ì‘ì—… í´ë” êµ¬ì¡° ë³€í™”

```mermaid
graph LR
    subgraph "Before ë‹¤ìš´ë¡œë“œ ì „"
        A1[CodePush/<br/>old_hash/<br/>v1.0.10]
    end
    
    subgraph "During ë‹¤ìš´ë¡œë“œ ì¤‘"
        B1[temp_multi_patch/<br/>workingFolder]
        B2[temp_multi_patch/<br/>patch_0/]
        B3[temp_multi_patch/<br/>result_0/]
        B4[temp_multi_patch/<br/>patch_1/]
        B5[temp_multi_patch/<br/>result_1/]
        
        B1 --> B2
        B2 --> B3
        B3 --> B1
        B1 --> B4
        B4 --> B5
        B5 --> B1
    end
    
    subgraph "After ì™„ë£Œ í›„"
        C1[CodePush/<br/>new_hash/<br/>v1.0.15]
        C2[CodePush/<br/>old_hash/<br/>v1.0.10<br/>ë¡¤ë°±ìš©]
    end
    
    A1 -.ë³µì‚¬.-> B1
    B1 -.ìµœì¢… ì´ë™.-> C1
    A1 -.ë³´ì¡´.-> C2
    
    style A1 fill:#e3f2fd
    style C1 fill:#c8e6c9
    style C2 fill:#fff9c4
```

---

## 5ï¸âƒ£ í•µì‹¬ ì½”ë“œ íë¦„: downloadPackage()

```mermaid
flowchart TD
    A[downloadPackage ì‹œì‘] --> B{patches ë°°ì—´<br/>ì²´í¬}
    
    B -->|ìˆìŒ| C[downloadAndApplyMultiplePatches<br/>í˜¸ì¶œ]
    B -->|ì—†ìŒ| D[ê¸°ì¡´ ë¡œì§<br/>ë‹¨ì¼ íŒ¨ì¹˜ ì²˜ë¦¬]
    
    C --> C1[ì„ì‹œ í´ë” ìƒì„±]
    C1 --> C2[currentPackage ë³µì‚¬]
    C2 --> C3[FOR LOOP ì‹œì‘]
    
    C3 --> C4[downloadSinglePatch<br/>ë‹¤ìš´ë¡œë“œ]
    C4 --> C5[ì••ì¶• í•´ì œ]
    C5 --> C6[tempResult ìƒì„±]
    C6 --> C7[diff ì ìš©<br/>deletedFiles ì‚­ì œ]
    C7 --> C8[ìƒˆ íŒŒì¼ ë³‘í•©]
    C8 --> C9[workingFolder êµì²´]
    
    C9 --> C10{ë‹¤ìŒ íŒ¨ì¹˜<br/>ìˆë‚˜?}
    C10 -->|ìˆìŒ| C4
    C10 -->|ì—†ìŒ| C11[ìµœì¢… ì´ë™]
    
    C11 --> E[ê²€ì¦]
    D --> E
    
    E --> F[í•´ì‹œ ê²€ì¦]
    F --> G[ì„œëª… ê²€ì¦]
    G --> H[ë©”íƒ€ë°ì´í„° ì €ì¥]
    H --> I[ì™„ë£Œ!]
    
    style A fill:#e1f5ff
    style C fill:#fff59d
    style D fill:#ffccbc
    style I fill:#c8e6c9
```

---

## 6ï¸âƒ£ ì—ëŸ¬ ì²˜ë¦¬ ë° ë³µêµ¬

```mermaid
flowchart TD
    A[ë‹¤ì¤‘ íŒ¨ì¹˜ ì‹œì‘] --> B[try ë¸”ë¡]
    
    B --> C{íŒ¨ì¹˜ ì²˜ë¦¬<br/>ì„±ê³µ?}
    
    C -->|ì„±ê³µ| D[ê²€ì¦ ì™„ë£Œ]
    D --> E[ë©”íƒ€ë°ì´í„° ì €ì¥]
    E --> F[finally:<br/>ì„ì‹œ í´ë” ì •ë¦¬]
    F --> G[ì™„ë£Œ!]
    
    C -->|ì‹¤íŒ¨| H[catch:<br/>ì—ëŸ¬ ë°œìƒ]
    H --> I[ìµœì¢… í´ë” ì‚­ì œ]
    I --> J[finally:<br/>ì„ì‹œ í´ë” ì •ë¦¬]
    J --> K[Exception throw]
    K --> L[ê¸°ì¡´ ë²„ì „ ìœ ì§€<br/>ë¡¤ë°±]
    
    style A fill:#e1f5ff
    style G fill:#c8e6c9
    style H fill:#ffcdd2
    style L fill:#fff9c4
```

### ğŸ›¡ï¸ ì•ˆì „ì¥ì¹˜
1. **try-catch-finally**: ëª¨ë“  ì—ëŸ¬ ì²˜ë¦¬
2. **ì„ì‹œ í´ë” ì •ë¦¬**: finallyì—ì„œ í•­ìƒ ì‹¤í–‰
3. **ì›ìì  ì‘ì—…**: ìµœì¢… ì´ë™ ì „ê¹Œì§€ ê¸°ì¡´ ë²„ì „ ìœ ì§€
4. **ë¡¤ë°± ê°€ëŠ¥**: previousPackage ë³´ì¡´

---

## 7ï¸âƒ£ ì„œë²„ ì‘ë‹µ êµ¬ì¡°

### ì‹±ê¸€ íŒ¨ì¹˜ ì‘ë‹µ
```json
{
  "update_info": {
    "download_url": "https://server/v1.0.11/diff.zip",
    "package_hash": "abc123",
    "label": "v1.0.11",
    "is_mandatory": true
  }
}
```

### ë©€í‹° íŒ¨ì¹˜ ì‘ë‹µ (ì‹ ê·œ)
```json
{
  "update_info": {
    "download_url": "https://server/v1.0.15/full.zip",
    "package_hash": "xyz789",
    "label": "v1.0.15",
    "is_mandatory": true,
    
    "current_label": "v1.0.10",
    "patches": [
      {
        "from_label": "v1.0.10",
        "to_label": "v1.0.11",
        "url": "https://server/v1.0.11/diff.zip",
        "hash": "aaa111",
        "size": 12345
      },
      {
        "from_label": "v1.0.11",
        "to_label": "v1.0.12",
        "url": "https://server/v1.0.12/diff.zip",
        "hash": "bbb222",
        "size": 23456
      }
    ]
  }
}
```

---

## 8ï¸âƒ£ ì²´í¬í¬ì¸íŠ¸: ì–´ë””ì„œ ë¶„ê¸°ë˜ë‚˜?

```mermaid
graph TD
    A[CodePushUpdateManager.java<br/>Line 146] --> B[downloadPackage ë©”ì„œë“œ]
    
    B --> C[Line 159:<br/>JSONArray patches =<br/>updatePackage.optJSONArray]
    
    C --> D{Line 160:<br/>patches != null &&<br/>patches.length > 0?}
    
    D -->|YES<br/>ë©€í‹° íŒ¨ì¹˜| E[Line 164:<br/>downloadAndApplyMultiplePatches<br/>í˜¸ì¶œ]
    
    D -->|NO<br/>ì‹±ê¸€ íŒ¨ì¹˜| F[Line 170-320:<br/>ê¸°ì¡´ ë¡œì§ ì‹¤í–‰]
    
    E --> G[Line 323:<br/>downloadAndApplyMultiplePatches<br/>ë©”ì„œë“œ ì‹œì‘]
    
    G --> H[ìƒˆë¡œìš´ ë©€í‹° íŒ¨ì¹˜ ë¡œì§]
    
    F --> I[ê¸°ì¡´ ë‹¨ì¼ íŒ¨ì¹˜ ë¡œì§]
    
    style D fill:#fff59d
    style E fill:#c8e6c9
    style F fill:#ffccbc
```

### ğŸ“ í•µì‹¬ ë¼ì¸
- **Line 159-167**: patches ë°°ì—´ ì²´í¬ (ë¶„ê¸°ì )
- **Line 323-425**: downloadAndApplyMultiplePatches() êµ¬í˜„
- **Line 427-499**: downloadSinglePatch() êµ¬í˜„
- **Line 170-320**: ê¸°ì¡´ ì‹±ê¸€ íŒ¨ì¹˜ ë¡œì§ (ìœ ì§€)

---

## 9ï¸âƒ£ ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ

### ì‹œë‚˜ë¦¬ì˜¤: v1.0.10 â†’ v1.0.15 ì—…ë°ì´íŠ¸

```mermaid
sequenceDiagram
    participant U as ì‚¬ìš©ì
    participant A as ì•±
    participant S as ì„œë²„
    participant N as Native
    
    U->>A: ì•± ì‹¤í–‰
    A->>S: ì—…ë°ì´íŠ¸ ì²´í¬<br/>(current: v1.0.10)
    S->>A: patches[] 5ê°œ ë°˜í™˜
    
    Note over A: patches ë°°ì—´ ê°ì§€!
    
    A->>N: downloadPackage(patches)
    
    Note over N: ë©€í‹° íŒ¨ì¹˜ ëª¨ë“œ
    
    N->>S: patch1 ë‹¤ìš´ë¡œë“œ
    S->>N: v1.0.11 diff
    Note over N: workingFolder = v1.0.11
    
    N->>S: patch2 ë‹¤ìš´ë¡œë“œ
    S->>N: v1.0.12 diff
    Note over N: workingFolder = v1.0.12
    
    N->>S: patch3, 4, 5 ë‹¤ìš´ë¡œë“œ
    S->>N: diff files
    Note over N: workingFolder = v1.0.15
    
    N->>N: ê²€ì¦ ì™„ë£Œ
    N->>A: ë‹¤ìš´ë¡œë“œ ì™„ë£Œ
    A->>U: "ì—…ë°ì´íŠ¸ ì™„ë£Œ<br/>ì¬ì‹œì‘í• ê¹Œìš”?"
    U->>A: ì¬ì‹œì‘
    A->>A: v1.0.15 ë¡œë“œ
    A->>U: ìµœì‹  ë²„ì „ ì‹¤í–‰! ğŸ‰
```

---

## ğŸ¯ ìš”ì•½: ì™œ ë©€í‹° íŒ¨ì¹˜ê°€ ì¢‹ì€ê°€?

| í•­ëª© | ì‹±ê¸€ íŒ¨ì¹˜ | ë©€í‹° íŒ¨ì¹˜ |
|------|----------|----------|
| **ì¬ì‹œì‘** | 5ë²ˆ ğŸ˜¡ | 1ë²ˆ ğŸ˜Š |
| **ì‚¬ìš©ì ëŒ€ê¸°** | 2ë¶„+ | 50ì´ˆ |
| **ì¤‘ê°„ ë²„ì „ ì‹¤í–‰** | 4ë²ˆ | 0ë²ˆ |
| **ë„¤íŠ¸ì›Œí¬ ë¹„ìš©** | ë™ì¼ | ë™ì¼ |
| **ë””ìŠ¤í¬ I/O** | ë§ìŒ | ì¤‘ê°„ |
| **ë³µì¡ë„** | ë‚®ìŒ | ì¤‘ê°„ |
| **ì•ˆì •ì„±** | ë†’ìŒ | ë†’ìŒ (ì—ëŸ¬ ì²˜ë¦¬ ì™„ë£Œ) |

### âœ… ê²°ë¡ 
**ë©€í‹° íŒ¨ì¹˜ëŠ” ì‚¬ìš©ì ê²½í—˜ì„ ê·¹ì ìœ¼ë¡œ ê°œì„ í•˜ë©´ì„œë„ ì•ˆì •ì„±ì„ ìœ ì§€í•©ë‹ˆë‹¤!**

---

## ğŸ“š ì°¸ê³  ë¬¸ì„œ
- `HANDOFF.md`: ìƒì„¸ êµ¬í˜„ ë‚´ìš©
- `FLOW.txt`: ì „ì²´ í”Œë¡œìš° (í…ìŠ¤íŠ¸)
- `TODO.md`: iOS ì‘ì—… í•­ëª©
